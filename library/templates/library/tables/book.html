<script>
    var table_book = $("#tabela_livros").dxDataGrid({
        dataSource: dados_tabela_livros,

        //options default
        allowColumnReordering: optionsDefaultTables.allowColumnReordering,
        filterRow: optionsDefaultTables.filterRow,
        export: optionsDefaultTables.export,
        onFileSaving: optionsDefaultTables.onFileSaving,
        headerFilter: optionsDefaultTables.headerFilter,
        grouping: optionsDefaultTables.grouping,
        groupPanel: optionsDefaultTables.groupPanel,
        filterPanel: optionsDefaultTables.filterPanel,
        filterBuilderPopup: optionsDefaultTables.filterBuilderPopup,
        paging: optionsDefaultTables.paging,
        pager: {
            showPageSizeSelector: true,
            allowedPageSizes: [10, 15, 50],
            showNavigationButtons: true,
            showInfo: true,
            infoText: "Página {0}/{1} ({2} livros)"
        },
        scrolling: optionsDefaultTables.scrolling,
        onContentReady: optionsDefaultTables.onContentReady,
        rowAlternationEnabled: optionsDefaultTables.rowAlternationEnabled,
        searchPanel: optionsDefaultTables.searchPanel,
        selection: optionsDefaultTables.selection,
        sorting: optionsDefaultTables.sorting,
        allowColumnResizing: optionsDefaultTables.allowColumnResizing,
        columnAutoWidth: optionsDefaultTables.columnAutoWidth,
        showColumnLines: optionsDefaultTables.showColumnLines,
        showRowLines: optionsDefaultTables.showRowLines,
        columnChooser: optionsDefaultTables.columnChooser,
        columnFixing: optionsDefaultTables.columnFixing,
        onEditorPreparing: function (e) {
            searchPanelCustomize(e);
            addBtnExport(e);
            resetGroupToolbar(e);
            btnFilterAdvanced(e);
            btnClearFilter(e);
            btnGroupGeneric(e, [
                [
                    {
                        btnClass: "btn btn-plus icon_plus seletorBtnAddProduto text-white",
                        btnTooltip: "Adicionar novo item",
                        btnClick: function () {
                            //Ação do botão
                            let modal = $("#modal_adicionar_livro");

                            $(".data").mask('00/00/0000');
                            // $(".data").datepicker('setDate', 'today');

                            //Limpa o modal
                            limpaModalCadastroItem();
                            //Busca a lista de autores
                            get_combo_authors();
                            // Busca a lista de status
                            get_item_status();
                            // Busca os tipos de itens
                            buscaTiposItens('livro');
                            // Busca as séries
                            get_combo_series();
                            // Busca as coleções
                            get_combo_collections();
                            //Busca as editoras
                            get_publishers();
                            // Busca os formatos
                            buscaFormatosItens()
                            //Busca os idiomas
                            get_languages('combo_language_add_book_library', null);

                            modal.modal('show');
                        }
                    },
                ]
            ]);
            addBtnChooser(e);
            btnAfterEnd(e);

        },

        columns: [
            {
                dataField: "id",
                caption: "Id",
                dataType: "number",
                visible: false,
                {#width: 225,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    container.css('text-align', 'center');
                    container.html(`
                    <span class="text-uppercase font-weight-semibold">${options.data[options.column.dataField]}</span>
                `);
                }
            },
            {
                dataField: "title",
                caption: "Título",
                dataType: "string",
                visible: true,
                {#width: 225,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var tdContent = `<p class="text-center font-weight-semibold">${options.data[options.column.dataField]}</p>`;
                    container.html(tdContent);

                    {#container.css('text-align', 'center');#}
                    {#    container.html(`#}
                    {#    <span class="text-uppercase font-weight-semibold">${options.data[options.column.dataField]}</span>#}
                    {#`);#}
                }
            },
            {
                dataField: "nm_main_author",
                caption: "Autor",
                dataType: "string",
                visible: true,
                {#groupIndex: 3,#}
                {#sortOrder: "asc",#}
                {#width: 225,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    if (true) {
                        options.component.collapseRow(options.component.getKeyByRowIndex(options.rowIndex));
                    }
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var tdContent = `<p class="text-center font-weight-semibold">${options.data[options.column.dataField]}</p>`;
                    container.html(tdContent);
                    {#    container.css('text-align', 'center');#}
                    {#    container.html(`#}
                    {#    <span class="text-uppercase font-weight-semibold">${options.data[options.column.dataField]}</span>#}
                    {#`);#}
                }
            },
            {
                dataField: "pages",
                caption: "Paginas",
                dataType: "number",
                visible: true,
                {#width: 150,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField];

                    var valueFormatado = "--";

                    if (parseFloat(value).toString() === "NaN" || parseFloat(value).toString() === "undefined") {
                    } else {

                        valueFormatado = parseFloat(value).toLocaleString('pt-BR', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 0
                        });
                        {#valueFormatado = "R$ " + valueFormatado#}
                    }

                    var tdContent = `<p class="text-center">${valueFormatado}</p>`;
                    container.html(tdContent);
                    {#    var dataField = options.column.dataField;#}
                    {#    container.css('text-align', 'center');#}
                    {#    container.html(`#}
                    {#    <span class="text-uppercase font-weight-semibold">${options.data[options.column.dataField]}</span>#}
                    {#`);#}

                }
            },
            {
                dataField: "volume",
                caption: "Vol.",
                dataType: "number",
                visible: true,
                {#width: 150,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField];

                    var valueFormatado = "--";

                    if (parseFloat(value).toString() === "NaN" || parseFloat(value).toString() === "undefined") {
                    } else {

                        valueFormatado = parseFloat(value).toLocaleString('pt-BR', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 0
                        })
                        {#valueFormatado = "R$ " + valueFormatado#}
                    }

                    var tdContent = `<p class="text-center">${valueFormatado}</p>`;
                    container.html(tdContent);
                }
            },
            {
                dataField: "cover_price",
                caption: "Valor",
                dataType: "number",
                visible: true,
                {#width: 150,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var valueFormatado = "--"

                    if (parseFloat(value).toString() === "NaN" || parseFloat(value).toString() === "undefined") {
                    } else {

                        valueFormatado = parseFloat(value).toLocaleString('pt-BR', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        })
                        valueFormatado = "R$ " + valueFormatado
                    }

                    var tdContent = `<p class="text-center">${valueFormatado}</p>`;
                    container.html(tdContent);

                }
            },
            {
                dataField: "nm_serie",
                caption: "Serie",
                dataType: "string",
                visible: false,
                {#width: 225,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var tdContent = `<p class="text-center">${options.data[options.column.dataField]}</p>`;
                    container.html(tdContent);
                    {#    container.css('text-align', 'center');#}
                    {#    container.html(`#}
                    {#    <span class="text-uppercase font-weight-semibold">${options.data[options.column.dataField]}</span>#}
                    {#`);#}
                }
            },
            {
                dataField: "nm_publisher",
                caption: "Editora",
                dataType: "string",
                visible: true,
                {#width: 150,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var valueFormatado = "--"

                    if (value === "NaN" || typeof value == "undefined" || value === null) {
                    } else {
                        valueFormatado = value
                    }

                    var tdContent = `<p class="text-center">${valueFormatado}</p>`;
                    container.html(tdContent);

                }
            },
            {
                dataField: "nm_last_status",
                caption: "Status",
                dataType: "string",
                visible: true,
                {#width: 150,#}
                headerCellTemplate: function (container, options) {
                    // função filterRow(container, options, headerDefault);
                    // 1 parâmetro, container: elemento HTML referente a este header
                    // 2 parâmetro, options: todas as opções referente a esta instancia do datagrid
                    // 3 parâmetro, headerDefault: recebe um booleano, caso você esteja inserindo um html diferente do que existe no ~caption: "NomeDaColuna"~ coloque o parâmetro false, indicando que o header não é default, caso contrário a função irá inserir o caption como nome da coluna por padrão, este parâmetro pode ser opcional.
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    var dataField = options.column.dataField;
                    var value = options.data[dataField]

                    var valueFormatado = "--"

                    if (value === "NaN" || typeof value == "undefined" || value === null) {
                    } else {
                        valueFormatado = value
                    }

                    if (options.data.id_last_status === 'desejado') {
                        container.parent().find('td').addClass('bg-blue-to-table');
                    }

                    var tdContent = `<p class="text-center">${valueFormatado}</p>`;
                    container.html(tdContent);

                }
            },
            {
                dataField: "path",
                caption: "Ações",
                dataType: "string",
                allowSorting: false,
                visible: true,
                allowHeaderFiltering: false,
                allowColumnReordering: false,
                allowColumnResizing: false,
                allowGrouping: false,
                headerCellTemplate: function (container, options) {
                    filterRow(container, options);
                },
                cellTemplate: function (container, options) {
                    replaceCell(container, options, "", "");

                    container.addClass('sem-cor');
                    let data_placement = "left";
                    container.removeClass('cursor-pointer').on('click', function (ev) {
                        ev.stopPropagation();
                    });
                    let botao_visualizar_livro = $("<a/>").addClass('ml-1 btn btn-acoes  text-white icon_eye').attr('data-toggle', 'tooltip').attr('data-placement', data_placement).attr('data-title', 'Visualizar livro').appendTo(container);
                    botao_visualizar_livro.on('click', function (ev) {
                        abrir_modal_item(options.data.id_last_status, options.data.id, options.data.item_type, options.data.id_serie, options.data.id_collection,
                            options.data.id_publisher, options.data.format, options.data.id_language);

                    });

                    //let botao_cancelar_pedido = $("<a/>").addClass(' ml-1 btn btn-danger seletorBtnCancelar text-white icon_trash').attr('data-toggle', 'tooltip').attr('data-placement', data_placement).attr('data-title', 'Fechar comanda').appendTo(container);
                    //botao_cancelar_pedido.on('click', function (ev) {
                    //    {#showDetails(options.data.num_comanda, 'fechar');#}
                    //});
                }
            },
        ]
    }).dxDataGrid("instance");
</script>